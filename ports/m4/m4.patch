diff -Paur --no-dereference -- m4.upstream/lib/freadahead.c m4/lib/freadahead.c
--- m4.upstream/lib/freadahead.c
+++ m4/lib/freadahead.c
@@ -30,6 +30,10 @@
 /* This file is not used on systems that have the __freadahead function,
    namely musl libc, Haiku >= hrev58760.  */
 
+#if defined(__sortix__)
+#include <FILE.h>
+#endif
+
 size_t
 freadahead (FILE *fp)
 {
@@ -94,6 +98,10 @@
   if (fp->state == 4 /* WR */ || fp->rp >= fp->wp)
     return 0;
   return fp->wp - fp->rp;
+#elif defined __sortix__
+  if ( !(fp->flags & _FILE_LAST_READ) )
+    return 0;
+  return fp->amount_input_buffered - fp->offset_input_buffer;
 #elif defined SLOW_BUT_NO_HACKS     /* users can define this */
   abort ();
   return 0;
diff -Paur --no-dereference -- m4.upstream/lib/spawn_faction_addclose.c m4/lib/spawn_faction_addclose.c
--- m4.upstream/lib/spawn_faction_addclose.c
+++ m4/lib/spawn_faction_addclose.c
@@ -22,7 +22,9 @@
 #include <errno.h>
 #include <unistd.h>
 
-#if !_LIBC
+#if defined(__sortix__)
+# define __sysconf(open_max) sysconf (open_max)
+#elif !_LIBC
 # define __sysconf(open_max) getdtablesize ()
 #endif
 
diff -Paur --no-dereference -- m4.upstream/lib/spawn_faction_adddup2.c m4/lib/spawn_faction_adddup2.c
--- m4.upstream/lib/spawn_faction_adddup2.c
+++ m4/lib/spawn_faction_adddup2.c
@@ -22,7 +22,9 @@
 #include <errno.h>
 #include <unistd.h>
 
-#if !_LIBC
+#if defined(__sortix__)
+# define __sysconf(open_max) sysconf (open_max)
+#elif !_LIBC
 # define __sysconf(open_max) getdtablesize ()
 #endif
 
diff -Paur --no-dereference -- m4.upstream/lib/spawn_faction_addopen.c m4/lib/spawn_faction_addopen.c
--- m4.upstream/lib/spawn_faction_addopen.c
+++ m4/lib/spawn_faction_addopen.c
@@ -24,7 +24,9 @@
 #include <string.h>
 #include <unistd.h>
 
-#if !_LIBC
+#if defined(__sortix__)
+# define __sysconf(open_max) sysconf (open_max)
+#elif !_LIBC
 # define __sysconf(open_max) getdtablesize ()
 #endif
 
diff -Paur --no-dereference -- m4.upstream/lib/spawni.c m4/lib/spawni.c
--- m4.upstream/lib/spawni.c
+++ m4/lib/spawni.c
@@ -951,16 +951,20 @@
     }
 #endif
 
+#if !defined(__sortix__)
   /* Set the process group ID.  */
   if ((flags & POSIX_SPAWN_SETPGROUP) != 0
       && setpgid (0, attrp->_pgrp) != 0)
     _exit (SPAWN_ERROR);
+#endif
 
+#if !defined(__sortix__)
   /* Set the effective user and group IDs.  */
   if ((flags & POSIX_SPAWN_RESETIDS) != 0
       && (local_seteuid (getuid ()) != 0
           || local_setegid (getgid ()) != 0))
     _exit (SPAWN_ERROR);
+#endif
 
   /* Execute the file actions.  */
   if (file_actions != NULL)
diff -Paur --no-dereference -- m4.upstream/lib/getlocalename_l-unsafe.c m4/lib/getlocalename_l-unsafe.c
--- m4.upstream/lib/getlocalename_l-unsafe.c
+++ m4/lib/getlocalename_l-unsafe.c
@@ -579,6 +579,8 @@
 #elif HAVE_NAMELESS_LOCALES
       /* OpenBSD >= 6.2, AIX >= 7.1 */
       return get_locale_t_name_unsafe (category, locale);
+#elif defined __sortix__
+      return (struct string_with_storage) { "C", STORAGE_INDEFINITE };
 #elif defined __OpenBSD__ && HAVE_FAKE_LOCALES
       /* OpenBSD >= 6.2 has only fake locales.  */
       if (locale == (locale_t) 2)
