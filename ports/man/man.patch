diff -Paur --no-dereference -- man.upstream/configure man/configure
--- man.upstream/configure
+++ man/configure
@@ -18,8 +18,7 @@
 
 set -e
 
-[ -w config.log ] && mv config.log config.log.old
-[ -w config.h   ] && mv config.h config.h.old
+# PATCH: Don't clutter the tree with useless old config files.
 
 # Output file descriptor usage:
 # 1 (stdout): config.h, Makefile.local
@@ -32,6 +31,7 @@
 # --- default settings -------------------------------------------------
 # Initialize all variables here,
 # such that nothing can leak in from the environment.
+# PATCH: NO. This configure is unexpected in many ways. Let's replace the logic.
 
 SOURCEDIR=`dirname "${0}"`
 
@@ -41,12 +41,7 @@
 OSNAME=
 UTF8_LOCALE=
 
-AR=ar
-CC=cc
-CFLAGS=
 FATAL=0
-LDADD=
-LDFLAGS=
 LD_NANOSLEEP=
 LD_OHASH=
 LD_RECVMSG=
@@ -102,18 +97,26 @@
 MANDOC_COBJS=
 SOELIM_COBJS=
 
-PREFIX="/usr/local"
-BINDIR=
-SBINDIR=
-BIN_FROM_SBIN=
-INCLUDEDIR=
-LIBDIR=
-MANDIR=
-READ_ALLOWED_PATH=
+# PATCH: Properly determine these locations with the below options.
+unset PREFIX
+unset EXEC_PREFIX
+unset BINDIR
+unset SBINDIR
+unset DATAROOTDIR
+unset INCLUDEDIR
+unset LIBDIR
+unset MANDIR
+unset SYSCONFDIR
+unset WWWPREFIX
+unset HTDOCDIR
+unset CGIBINDIR
+unset BIN_FROM_SBIN
+
+unset BUILD
+unset HOST
+unset TARGET
 
-WWWPREFIX="/var/www"
-HTDOCDIR=
-CGIBINDIR=
+READ_ALLOWED_PATH=
 
 BINM_APROPOS="apropos"
 BINM_CATMAN="catman"
@@ -121,7 +124,7 @@
 BINM_MAN="man"
 BINM_SOELIM="soelim"
 BINM_WHATIS="whatis"
-BINM_PAGER=
+BINM_PAGER="less"
 MANM_MAN="man"
 MANM_MANCONF="man.conf"
 MANM_MDOC="mdoc"
@@ -136,18 +139,107 @@
 INSTALL_DATA=
 LN="ln -f"
 
-# --- manual settings from configure.local -----------------------------
+# PATCH: Implement standard configure script options.
+
 
-if [ -r ./configure.local ]; then
-	echo "file configure.local: reading..." 1>&2
-	echo "file configure.local: reading..." 1>&3
-	cat ./configure.local 1>&3
-	. ./configure.local
+dashdash=
+previous_option=
+option_checking=true
+for argument do
+  if test -n "$previous_option"; then
+    eval $previous_option=\$argument
+    previous_option=
+    continue
+  fi
+
+  case $argument in
+  *=?*) parameter=$(expr "X$argument" : '[^=]*=\(.*\)') ;;
+  *=)   parameter= ;;
+  *)    parameter=yes ;;
+  esac
+
+  case $dashdash$argument in
+  --) dashdash=yes ;;
+  --build=*) BUILD=$parameter ;;
+  --build) previous_option=BUILD ;;
+  --bindir=*) BINDIR=$parameter ;;
+  --bindir) previous_option=BINDIR ;;
+  --cgibindir) previous_option=CGIBINDIR ;;
+  --cgibindir=*) CGIBINDIR=$parameter ;;
+  --datarootdir=*) DATAROOTDIR=$parameter ;;
+  --datarootdir) previous_option=DATAROOTDIR ;;
+  --disable-cgi) BUILD_CGI=0 ;;
+  --disable-catman) BUILD_CATMAN=0 ;;
+  --disable-less-T) HAVE_LESS_T=0 ;;
+  --disable-libmandoc) INSTALL_LIBMANDOC=0 ;;
+  --enable-cgi) BUILD_CGI=1 ;;
+  --enable-catman) BUILD_CATMAN=1 ;;
+  --enable-less-T) HAVE_LESS_T=1 ;;
+  --enable-libmandoc) INSTALL_LIBMANDOC=1 ;;
+  --exec-prefix=*) EXEC_PREFIX=$parameter ;;
+  --exec-prefix) previous_option=EXEC_PREFIX ;;
+  --host=*) HOST=$parameter ;;
+  --host) previous_option=HOST ;;
+  --htdocsdir) previous_option=HTDOCDIR ;;
+  --htdocsdir=*) HTDOCDIR=$parameter ;;
+  --includedir=*) INCLUDEDIR=$parameter ;;
+  --includedir) previous_option=INCLUDEDIR ;;
+  --libdir=*) LIBDIR=$parameter ;;
+  --libdir) previous_option=LIBDIR ;;
+  --mandir=*) MANDIR=$parameter ;;
+  --mandir) previous_option=MANDIR ;;
+  --prefix=*) PREFIX=$parameter ;;
+  --prefix) previous_option=PREFIX ;;
+  --sbindir) previous_option=SBINDIR ;;
+  --sbindir=*) SBINDIR=$parameter ;;
+  --sysconfdir) previous_option=SYSCONFDIR ;;
+  --sysconfdir=*) SYSCONFDIR=$parameter ;;
+  --target=*) TARGET=$parameter ;;
+  --target) previous_option=TARGET ;;
+  --www-prefix) previous_option=WWWPREFIX ;;
+  --www-prefix=*) WWWPREFIX=$parameter ;;
+  --with-pager) previous_option=BINM_PAGER ;;
+  --with-pager=*) BINM_PAGER=$parameter ;;
+  --with-manpath) previous_option=MANPATH_DEFAULT ;;
+  --with-manpath=*) MANPATH_DEFAULT=$parameter ;;
+  --with-manpath-base) previous_option=MANPATH_BASE ;;
+  --with-manpath-base=*) MANPATH_BASE=$parameter ;;
+  -h | --help | --help=*) exit 0 ;;
+  -V | --version) exit 0 ;;
+  *) echo "$0: ignoring unexpected operand $argument" >&2
+  esac
+done
+
+if test -n "$previous_option"; then
+  echo "$0: option '$argument' requires an argument" >&2
+  exit 1
+fi
+
+[ -z ${PREFIX+x}        ] && PREFIX="/usr/local"
+[ -z ${EXEC_PREFIX+x}   ] && EXEC_PREFIX="$PREFIX"
+[ -z ${BINDIR+x}        ] && BINDIR="$EXEC_PREFIX/bin"
+[ -z ${SBINDIR+x}       ] && SBINDIR="$EXEC_PREFIX/sbin"
+[ -z ${SYSCONFDIR+x}    ] && SYSCONFDIR="$PREFIX/etc"
+[ -z ${DATAROOTDIR+x}   ] && DATAROOTDIR="$PREFIX/share"
+[ -z ${INCLUDEDIR+x}    ] && INCLUDEDIR="$PREFIX/include"
+[ -z ${LIBDIR+x}        ] && LIBDIR="$EXEC_PREFIX/lib"
+[ -z ${MANDIR+x}        ] && MANDIR="$DATAROOTDIR/man"
+[ -z ${WWWPREFIX+x}     ] && WWWPREFIX="$WWWPREFIX/var/www"
+[ -z "${HTDOCDIR}"      ] && HTDOCDIR="${WWWPREFIX}/htdocs"
+[ -z "${CGIBINDIR}"     ] && CGIBINDIR="${WWWPREFIX}/cgi-bin"
+[ -z "${BIN_FROM_SBIN}" ] && BIN_FROM_SBIN="../bin"
+
+
+if [ "$BUILD" != "$HOST" ]; then
+  CROSS_COMPILING=yes
+  TOOLCHAIN_PREFIX="$HOST-"
 else
-	echo "file configure.local: no (fully automatic configuration)" 1>&2
-	echo "file configure.local: no (fully automatic configuration)" 1>&3
+  CROSS_COMPILING=no
+  TOOLCHAIN_PREFIX=""
 fi
-echo 1>&3
+
+AR=${AR-${TOOLCHAIN_PREFIX}ar}
+CC=${CC-${TOOLCHAIN_PREFIX}cc}
 
 # --- tests functions --------------------------------------------------
 
@@ -184,9 +276,15 @@
 		return 1
 	fi
 
-	if ./test-${1} 1>&3 2>&3; then
-		echo "tested ${n}: yes" 1>&2
-		echo "result of running ${n}: yes" 1>&3
+	# PATCH: Tests can't be run when cross-compiling.
+    if [ $CROSS_COMPILING = yes ] || ./test-${1} 1>&3 2>&3; then
+        if [ $CROSS_COMPILING = yes ]; then
+		  echo "tested ${n}: guessing yes (cross-compiling)" 1>&2
+		  echo "result of running ${n}: guessing yes (cross-compiling)" 1>&3
+        else
+		  echo "tested ${n}: yes" 1>&2
+		  echo "result of running ${n}: yes" 1>&3
+        fi
 		echo 1>&3
 		eval HAVE_${2}=1
 		[ "${3}" = "-D_GNU_SOURCE" ] && NEED_GNU_SOURCE=1
@@ -366,6 +464,11 @@
 # --- tagging support in the pager ---
 if ismanual "${BINM_PAGER} -T" LESS_T ${HAVE_LESS_T}; then
 	:
+elif [ "$CROSS_COMPILING" = yes ]; then
+	HAVE_LESS_T=1
+	echo "tested ${BINM_PAGER} -T: guessing yes (cross-compiling)" 1>&2
+	echo "tested ${BINM_PAGER} -T: guessing yes (cross-compiling)" 1>&3
+	echo 1>&3
 elif ${BINM_PAGER} -T /dev/null test-noop.c 1>/dev/null 2>&3; then
 	HAVE_LESS_T=1
 	echo "tested ${BINM_PAGER} -T: yes" 1>&2
@@ -607,16 +710,6 @@
 
 exec > Makefile.local
 
-[ -z "${BINDIR}"          ] && BINDIR="${PREFIX}/bin"
-[ -z "${SBINDIR}"         ] && SBINDIR="${PREFIX}/sbin"
-[ -z "${BIN_FROM_SBIN}"   ] && BIN_FROM_SBIN="../bin"
-[ -z "${INCLUDEDIR}"      ] && INCLUDEDIR="${PREFIX}/include/mandoc"
-[ -z "${LIBDIR}"          ] && LIBDIR="${PREFIX}/lib/mandoc"
-[ -z "${MANDIR}"          ] && MANDIR="${PREFIX}/man"
-
-[ -z "${HTDOCDIR}"        ] && HTDOCDIR="${WWWPREFIX}/htdocs"
-[ -z "${CGIBINDIR}"       ] && CGIBINDIR="${WWWPREFIX}/cgi-bin"
-
 [ -z "${INSTALL_PROGRAM}" ] && INSTALL_PROGRAM="${INSTALL} -m 0555"
 [ -z "${INSTALL_LIB}"     ] && INSTALL_LIB="${INSTALL} -m 0444"
 [ -z "${INSTALL_MAN}"     ] && INSTALL_MAN="${INSTALL} -m 0444"
diff -Paur --no-dereference -- man.upstream/dbm_map.c man/dbm_map.c
--- man.upstream/dbm_map.c
+++ man/dbm_map.c
@@ -75,7 +75,11 @@
 		errno = EFBIG;
 		goto fail;
 	}
+#if !defined(__sortix__) || defined(__SORTIX_HAS_WORKING_MAP_SHARED__)
 	if ((dbm_base = mmap(NULL, st.st_size, PROT_READ, MAP_SHARED,
+#else
+	if ((dbm_base = mmap(NULL, st.st_size, PROT_READ, MAP_PRIVATE,
+#endif
 	    ifd, 0)) == MAP_FAILED)
 		goto fail;
 	magic = dbm_getint(0);
diff -Paur --no-dereference -- man.upstream/main.c man/main.c
--- man.upstream/main.c
+++ man/main.c
@@ -22,7 +22,6 @@
 
 #include <sys/types.h>
 #include <sys/ioctl.h>
-#include <sys/param.h>	/* MACHINE */
 #include <sys/stat.h>
 #include <sys/wait.h>
 
@@ -822,8 +821,11 @@
 	return globres;
 
 found:
+	// PATCH: Sortix binary packages use loose files rather than mandoc.db.
+#if 0
 	warnx("outdated mandoc.db lacks %s(%s) entry, run %s %s",
 	    name, sec, BINM_MAKEWHATIS, paths->paths[ipath]);
+#endif
 	if (res == NULL)
 		free(file);
 	else if (file == NULL)
diff -Paur --no-dereference -- man.upstream/mandocdb.c man/mandocdb.c
--- man.upstream/mandocdb.c
+++ man/mandocdb.c
@@ -180,10 +180,11 @@
 static	int		 use_all; /* use all found files */
 static	int		 debug; /* print what we're doing */
 static	int		 warnings; /* warn about crap */
-static	int		 write_utf8; /* write UTF-8 output; else ASCII */
+static	int		 write_utf8 = 1; /* write UTF-8 output; else ASCII */
 static	int		 exitcode; /* to be returned by main */
 static	enum op		 op; /* operational mode */
-static	char		 basedir[PATH_MAX]; /* current base directory */
+static	char		 basedir_empty[] = "";
+static	char*		 basedir = basedir_empty; /* current base directory */
 static	size_t		 basedir_len; /* strlen(basedir) */
 static	struct mpage	*mpage_head; /* list of distinct manual pages */
 static	struct ohash	 mpages; /* table of distinct manual pages */
@@ -576,7 +577,9 @@
 static int
 treescan(void)
 {
-	char		 buf[PATH_MAX];
+	/* PATCH: Use realpath without a destination buffer so it's well-defined
+	          when PATH_MAX doesn't exist, like on Sortix. */
+	char		*buf;
 	FTS		*f;
 	FTSENT		*ff;
 	struct mlink	*mlink;
@@ -609,7 +612,7 @@
 		 * then get handled just like regular files.
 		 */
 		case FTS_SL:
-			if (realpath(path, buf) == NULL) {
+			if (NULL == (buf = realpath(path, NULL))) {
 				if (warnings)
 					say(path, "&realpath");
 				continue;
@@ -621,8 +624,10 @@
 			) {
 				if (warnings) say("",
 				    "%s: outside base directory", buf);
+				free(buf);
 				continue;
 			}
+			free(buf);
 			/* Use logical inode to avoid mpages dupe. */
 			if (stat(path, ff->fts_statp) == -1) {
 				if (warnings)
@@ -2308,6 +2313,7 @@
 	static char	 startdir[PATH_MAX];
 	static int	 getcwd_status;  /* 1 = ok, 2 = failure */
 	static int	 chdir_status;  /* 1 = changed directory */
+    char *new_basedir;
 
 	/*
 	 * Remember the original working directory, if possible.
@@ -2355,21 +2361,23 @@
 	 * pathname and append a trailing slash, such that
 	 * we can reliably check whether files are inside.
 	 */
-	if (realpath(targetdir, basedir) == NULL) {
+	if ((new_basedir = realpath(targetdir, NULL)) == NULL) {
 		if (report_baddir || errno != ENOENT) {
 			exitcode = (int)MANDOCLEVEL_BADARG;
 			say("", "&%s: realpath", targetdir);
 		}
-		*basedir = '\0';
 		return 0;
-	} else if (chdir(basedir) == -1) {
+	} else if (chdir(new_basedir) == -1) {
 		if (report_baddir || errno != ENOENT) {
 			exitcode = (int)MANDOCLEVEL_BADARG;
 			say("", "&chdir");
 		}
-		*basedir = '\0';
+		free(new_basedir);
 		return 0;
 	}
+	if (basedir != basedir_empty)
+		free(basedir);
+	basedir = new_basedir;
 	chdir_status = 1;
 	basedir_len = strlen(basedir);
 	if (basedir[basedir_len - 1] != '/') {
diff -Paur --no-dereference -- man.upstream/manpath.c man/manpath.c
--- man.upstream/manpath.c
+++ man/manpath.c
@@ -119,24 +119,27 @@
 static void
 manpath_add(struct manpaths *dirs, const char *dir, char option)
 {
-	char		 buf[PATH_MAX];
 	struct stat	 sb;
 	char		*cp;
 	size_t		 i;
 
-	if ((cp = realpath(dir, buf)) == NULL)
+	if ((cp = realpath(dir, NULL)) == NULL)
 		goto fail;
 
 	for (i = 0; i < dirs->sz; i++)
-		if (strcmp(dirs->paths[i], dir) == 0)
+		if (strcmp(dirs->paths[i], dir) == 0) {
+			free(cp);
 			return;
+		}
 
-	if (stat(cp, &sb) == -1)
+	if (stat(cp, &sb) == -1) {
+		free(cp);
 		goto fail;
+	}
 
 	dirs->paths = mandoc_reallocarray(dirs->paths,
 	    dirs->sz + 1, sizeof(*dirs->paths));
-	dirs->paths[dirs->sz++] = mandoc_strdup(cp);
+	dirs->paths[dirs->sz++] = cp;
 	return;
 
 fail:
