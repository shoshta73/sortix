diff -Paur --no-dereference -- flex.upstream/src/config.h.in flex/src/config.h.in
--- flex.upstream/src/config.h.in
+++ flex/src/config.h.in
@@ -10,7 +10,14 @@
 
 /* Define to 1 if translation of program messages to the user's native
    language is requested. */
+/* PATCH: Unfortunately stage1flex is built on the build machine, but configure
+          does not detect how to link with libintl with CC_FOR_BUILD, causing
+          link failures when cross-compiling from a system using libintl.
+          Adding proper support to configure is too big to patch in, so instead
+          the easiest solution is to disable nls in the temporary stage1flex. */
+#ifndef STAGE1FLEX
 #undef ENABLE_NLS
+#endif
 
 /* Define to 1 if you have `alloca', as a function or macro. */
 #undef HAVE_ALLOCA
diff -Paur --no-dereference -- flex.upstream/configure flex/configure
--- flex.upstream/configure
+++ flex/configure
@@ -1,4 +1,6 @@
 #! /bin/sh
+export ac_cv_func_malloc_0_nonnull=yes
+export ac_cv_func_realloc_0_nonnull=yes
 # Guess values for system-dependent variables and create Makefiles.
 # Generated by GNU Autoconf 2.69 for the fast lexical analyser generator 2.6.4.
 #
diff -Paur --no-dereference -- flex.upstream/src/main.c flex/src/main.c
--- flex.upstream/src/main.c
+++ flex/src/main.c
@@ -342,43 +342,7 @@
     /* Setup the filter chain. */
     output_chain = filter_create_int(NULL, filter_tee_header, headerfilename);
     if ( !(m4 = getenv("M4"))) {
-	    char *slash;
-		m4 = M4;
-		if ((slash = strrchr(M4, '/')) != NULL) {
-			m4 = slash+1;
-			/* break up $PATH */
-			const char *path = getenv("PATH");
-			if (!path) {
-				m4 = M4;
-			} else {
-				int m4_length = strlen(m4);
-				do {
-					size_t length = strlen(path);
-					struct stat sbuf;
-
-					const char *endOfDir = strchr(path, ':');
-					if (!endOfDir)
-						endOfDir = path+length;
-
-					{
-						char *m4_path = calloc(endOfDir-path + 1 + m4_length + 1, 1);
-
-						memcpy(m4_path, path, endOfDir-path);
-						m4_path[endOfDir-path] = '/';
-						memcpy(m4_path + (endOfDir-path) + 1, m4, m4_length + 1);
-						if (stat(m4_path, &sbuf) == 0 &&
-							(S_ISREG(sbuf.st_mode)) && sbuf.st_mode & S_IXUSR) {
-							m4 = m4_path;
-							break;
-						}
-						free(m4_path);
-					}
-					path = endOfDir+1;
-				} while (path[0]);
-				if (!path[0])
-				    m4 = M4;
-			}
-		}
+		m4 = "m4";
 	}
     filter_create_ext(output_chain, m4, "-P", 0);
     filter_create_int(output_chain, filter_fix_linedirs, NULL);
diff -Paur --no-dereference -- flex.upstream/src/Makefile.in flex/src/Makefile.in
--- flex.upstream/src/Makefile.in
+++ flex/src/Makefile.in
@@ -298,7 +298,7 @@
 CCDEPMODE = @CCDEPMODE@
 CC_FOR_BUILD = @CC_FOR_BUILD@
 CFLAGS = @CFLAGS@
-CFLAGS_FOR_BUILD = @CFLAGS_FOR_BUILD@
+CFLAGS_FOR_BUILD = @CFLAGS_FOR_BUILD@ -DSTAGE1FLEX
 CPP = @CPP@
 CPPFLAGS = @CPPFLAGS@
 CPPFLAGS_FOR_BUILD = @CPPFLAGS_FOR_BUILD@
